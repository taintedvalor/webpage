<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Problem Tracker</title>
    <style>
        /* Your previous CSS styles go here */
    </style>
</head>
<body>
    <h1>Problem Tracker</h1>
    <div class="container">
        <div class="input-container">
            <input type="text" id="title-input" placeholder="Title">
            <input type="text" id="description-input" placeholder="Description">
        </div>
        <button id="add-problem-button">Add Problem</button>
    </div>
    <div id="problem-list">
        <!-- Problems will be added here dynamically -->
    </div>

    <script>
        // Function to fetch problems from the server and display them
        async function fetchProblems() {
            try {
                const response = await fetch('/api/problems');
                const problems = await response.json();

                const problemList = document.getElementById('problem-list');
                problemList.innerHTML = '';

                problems.forEach(problem => {
                    const problemElement = createProblemElement(problem);
                    problemList.appendChild(problemElement);
                });
            } catch (error) {
                console.error('Error fetching problems:', error);
            }
        }

        // Function to create a problem element
        function createProblemElement(problem) {
            const problemDiv = document.createElement('div');
            problemDiv.className = 'problem';

            const title = document.createElement('h3');
            title.textContent = problem.title;

            const description = document.createElement('p');
            description.textContent = problem.description;

            const statusSelect = document.createElement('select');
            statusSelect.addEventListener('change', () => updateProblemStatus(problem, statusSelect.value));
            
            const statusOptions = ['unhandled', 'ongoing', 'incomplete'];
            statusOptions.forEach(option => {
                const statusOption = document.createElement('option');
                statusOption.value = option;
                statusOption.textContent = option.charAt(0).toUpperCase() + option.slice(1);
                statusSelect.appendChild(statusOption);
            });
            statusSelect.value = problem.status;

            const deleteButton = document.createElement('button');
            deleteButton.className = 'delete-button';
            deleteButton.textContent = 'Delete';
            deleteButton.addEventListener('click', () => deleteProblem(problem));

            problemDiv.appendChild(title);
            problemDiv.appendChild(description);
            problemDiv.appendChild(statusSelect);
            problemDiv.appendChild(deleteButton);

            return problemDiv;
        }

        // Function to add a new problem
        async function addProblem() {
            const titleInput = document.getElementById('title-input');
            const descriptionInput = document.getElementById('description-input');

            const title = titleInput.value.trim();
            const description = descriptionInput.value.trim();

            if (title !== '' && description !== '') {
                const problemData = { title, description };
                try {
                    const response = await fetch('/api/problems', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(problemData)
                    });

                    if (response.status === 201) {
                        fetchProblems(); // Refresh the list of problems
                        titleInput.value = '';
                        descriptionInput.value = '';
                    } else {
                        console.error('Failed to add problem.');
                    }
                } catch (error) {
                    console.error('Error adding problem:', error);
                }
            }
        }

        // Function to update the status of a problem
        async function updateProblemStatus(problem, newStatus) {
            problem.status = newStatus;

            try {
                const response = await fetch(`/api/problems/${problem.id}`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status: newStatus })
                });

                if (response.status !== 200) {
                    console.error('Failed to update problem status.');
                    fetchProblems(); // Refresh the list to revert changes
                }
            } catch (error) {
                console.error('Error updating problem status:', error);
                fetchProblems(); // Refresh the list to revert changes
            }
        }

        // Function to delete a problem
        async function deleteProblem(problem) {
            try {
                const response = await fetch(`/api/problems/${problem.id}`, {
                    method: 'DELETE'
                });

                if (response.status === 204) {
                    fetchProblems(); // Refresh the list of problems
                } else {
                    console.error('Failed to delete problem.');
                }
            } catch (error) {
                console.error('Error deleting problem:', error);
            }
        }

        // Add an event listener for the "Add Problem" button
        const addProblemButton = document.getElementById('add-problem-button');
        addProblemButton.addEventListener('click', addProblem);

        // Fetch and display problems on page load
        fetchProblems();
    </script>
</body>
</html>

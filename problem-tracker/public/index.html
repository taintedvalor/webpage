<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Problem Tracker</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Problem Tracker</h1>

    <!-- Search bar in the top right corner -->
    <div class="search-container">
        <input type="text" id="searchInput" placeholder="Search by problem name">
    </div>

    <!-- Problem tracker in the middle -->
    <div id="problems-container">
        <!-- Existing problems will be loaded dynamically here via JavaScript -->
    </div>

    <!-- Input for adding a new problem at the bottom -->
    <div class="add-problem-container">
        <input type="text" id="problemName" placeholder="Enter problem name" required>
        <button id="addProblem">Add Problem</button>
    </div>

    <!-- Modpack version information -->
    <div id="modpackVersion"></div>

    <script>
        const problemsContainer = document.getElementById("problems-container");
        const searchInput = document.getElementById("searchInput");
        const addProblemButton = document.getElementById("addProblem");
        const problemNameInput = document.getElementById("problemName");
        const modpackVersion = document.getElementById("modpackVersion");

        // Function to load problems from the server
        async function loadProblems() {
            const response = await fetch('/problems');
            const problems = await response.json();

            problemsContainer.innerHTML = ''; // Clear existing problems

            problems.forEach(problem => {
                const problemDiv = createProblemElement(problem);
                problemsContainer.appendChild(problemDiv);
            });
        }

        // Function to create a new problem element
        function createProblemElement(problem) {
            const problemDiv = document.createElement("div");
            problemDiv.className = `problem ${problem.status}`;
            problemDiv.innerHTML = `
                <div class="problem-header">${problem.title}</div>
                <div>Status: ${problem.status}</div>
                
                <!-- Add buttons for editing and deleting (only if the user created the problem) -->
                ${problem.editable ? `
                    <button class="edit-button" data-id="${problem.id}">Edit</button>
                    <button class="delete-button" data-id="${problem.id}">Delete</button>
                ` : ''}
            `;

            // Add event listeners for edit and delete (only if the user created the problem)
            if (problem.editable) {
                const editButton = problemDiv.querySelector(".edit-button");
                const deleteButton = problemDiv.querySelector(".delete-button");

                editButton.addEventListener("click", () => {
                    editProblem(problem.id);
                });

                deleteButton.addEventListener("click", () => {
                    deleteProblem(problem.id);
                });
            }

            return problemDiv;
        }

        // Function to add a new problem
        async function addProblem() {
            const problemName = problemNameInput.value.trim();
            if (problemName === "") {
                return; // Don't add empty problems
            }

            const response = await fetch('/problems', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    title: problemName,
                    status: "Unattended",
                    editable: true, // The user who adds a problem can edit and delete it
                }),
            });

            if (response.status === 201) {
                problemNameInput.value = ""; // Clear the input field
                loadProblems();
            }
        }

        // Function to edit a problem (placeholder, you can implement this if needed)
        function editProblem(id) {
            // Implement edit functionality here
        }

        // Function to delete a problem
        async function deleteProblem(id) {
            const response = await fetch(`/problems/${id}`, {
                method: 'DELETE',
            });

            if (response.status === 204) {
                loadProblems();
            }
        }

        // Function to filter problems by name
        function filterProblemsByName() {
            const searchValue = searchInput.value.toLowerCase();
            const problemElements = Array.from(problemsContainer.getElementsByClassName("problem"));

            problemElements.forEach(problemDiv => {
                const problemHeader = problemDiv.querySelector(".problem-header").textContent.toLowerCase();
                if (problemHeader.includes(searchValue)) {
                    problemDiv.style.display = "block";
                } else {
                    problemDiv.style.display = "none";
                }
            });
        }

        // Attach event listeners
        addProblemButton.addEventListener("click", addProblem);
        searchInput.addEventListener("input", filterProblemsByName);

        // Load existing problems when the page loads
        loadProblems();

        // Set the modpack version (you can replace this with actual version information)
        modpackVersion.textContent = "Modpack Version: Customizable";
    </script>
</body>
</html>
